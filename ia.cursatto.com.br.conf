# =====================================================================
# Userdata SSL Include (cPanel EasyApache 4 - Apache 2.4)
# Domain: ia.cursatto.com.br
# User:   cursattocom
#
# ATENÇÃO:
# - NÃO coloque <VirtualHost *:443> aqui.
# - NÃO coloque SSLCertificateFile/KeyFile/ChainFile aqui.
#   O cPanel/AutoSSL já gerencia o SSL no vhost principal.
# /etc/apache2/conf.d/userdata/ssl/2_4/cursattocom/ia.cursatto.com.br/ia.cursatto.com.br.conf
# =====================================================================

# --- Proxy / Reverse Proxy ---
ProxyRequests Off
ProxyPreserveHost On

# --- Forwarded headers (para o n8n saber que está atrás de HTTPS) ---
RequestHeader set X-Forwarded-Proto "https"
RequestHeader set X-Forwarded-Port "443"

# --- Timeouts (evita queda em execuções longas / editor) ---
Timeout 600
ProxyTimeout 600

# --- WebSocket do Editor (precisa vir ANTES do "/") ---
ProxyPass        "/rest/push"  "ws://127.0.0.1:5678/rest/push"  retry=0 timeout=600
ProxyPassReverse "/rest/push"  "ws://127.0.0.1:5678/rest/push"

# --- N8N (restante) ---
ProxyPass        "/"  "http://127.0.0.1:5678/"  retry=0 timeout=300
ProxyPassReverse "/"  "http://127.0.0.1:5678/"

# --- Ajustes de cookie/domínio quando há proxy ---
ProxyPassReverseCookieDomain 127.0.0.1 ia.cursatto.com.br
ProxyPassReverseCookiePath / /

# --- Headers úteis (opcional) ---
Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
Header always set X-Content-Type-Options "nosniff"
Header always set X-Frame-Options "SAMEORIGIN"
Header always set Referrer-Policy "strict-origin-when-cross-origin"
